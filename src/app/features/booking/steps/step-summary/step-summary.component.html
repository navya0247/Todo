<div class="summary-container">
    <div class="header-section">
        <h2>Review Booking</h2>
        <p class="subtitle">Double check your booking details</p>
    </div>

    <div class="summary-grid">
        <!-- Left: Details -->
        <div class="details-section">
            <div class="summary-card">
                <div class="section-header">
                    <span class="dot"></span>
                    <h3>Booking Summary</h3>
                </div>

                <div class="info-group">
                    <div class="info-item">
                        <div class="icon-circle">üë§</div>
                        <div class="text">
                            <span class="label">Expert</span>
                            <span class="value">{{ expert?.name }}</span>
                            <div class="expert-info">
                                <span class="rating">‚≠ê {{ expert?.rating }}</span>
                                <span class="bullet">‚Ä¢</span>
                                <span class="role">{{ expert?.service }}</span>
                            </div>
                        </div>
                    </div>

                    <div class="info-item">
                        <div class="icon-circle">üìÖ</div>
                        <div class="text">
                            <span class="label">Scheduled For</span>
                            <span class="value" *ngIf="slot?.type === 'ASAP'">‚ö° ASAP Arrival</span>
                            <span class="value" *ngIf="slot?.type === 'SCHEDULED'">
                                {{ slot.date | date:'EEE, MMM d' }} at {{ slot.time }}
                            </span>
                        </div>
                    </div>

                    <div class="info-item">
                        <div class="icon-circle">üìç</div>
                        <div class="text">
                            <span class="label">Service Location</span>
                            <span class="value">{{ address?.label }}</span>
                            <span class="sub-text">{{ address?.line1 }}, {{ address?.city }}</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Coupons -->
            <div class="summary-card">
                <div class="section-header">
                    <span class="dot blue"></span>
                    <h3>Available Offers</h3>
                </div>
                <div class="coupon-grid">
                    <div class="coupon-tile" *ngFor="let coupon of coupons"
                        [class.applied]="selectedCoupon?.id === coupon.id" (click)="applyCoupon(coupon)">
                        <div class="coupon-info">
                            <div class="code-badge">{{ coupon.code }}</div>
                            <span class="description">{{ coupon.description }}</span>
                        </div>
                        <div class="status-indicator">
                            <div class="check" *ngIf="selectedCoupon?.id === coupon.id">‚úì</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right: Price Details -->
        <div class="price-section">
            <div class="price-sticky-card">
                <h3>Payment Summary</h3>

                <div class="price-breakdown">
                    <div class="price-row">
                        <span class="label">Base Price</span>
                        <span class="value">‚Çπ{{ basePrice }}</span>
                    </div>

                    <div class="price-row discount" *ngIf="discount > 0">
                        <span class="label">Coupon ({{ selectedCoupon?.code }})</span>
                        <span class="value">-‚Çπ{{ discount | number:'1.0-0' }}</span>
                    </div>

                    <div class="price-row">
                        <span class="label">GST (18%)</span>
                        <span class="value">‚Çπ{{ taxes | number:'1.0-0' }}</span>
                    </div>

                    <div class="total-divider"></div>

                    <div class="price-row total">
                        <span class="label">Total to Pay</span>
                        <span class="value">‚Çπ{{ finalAmount | number:'1.0-0' }}</span>
                    </div>
                </div>

                <button class="btn-pay-premium" (click)="openPaymentModal()" [disabled]="isProcessing">
                    <span class="btn-text">Proceed to Payment</span>
                    <span class="chevron">‚Üí</span>
                </button>

                <div class="trust-badges">
                    <div class="trust-item">üõ°Ô∏è Secure Payment</div>
                    <div class="trust-item">‚≠ê Verified Expert</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Payment Modal -->
    <div class="modal-overlay" *ngIf="showPaymentModal" (click)="closeModal($event)">
        <div class="modal-content" (click)="$event.stopPropagation()">
            <div class="modal-header">
                <h3>Payment Details</h3>
                <button class="close-btn" (click)="showPaymentModal = false">√ó</button>
            </div>

            <div class="modal-body">
                <!-- Success State -->
                <div class="status-view" *ngIf="paymentStatus === 'success'">
                    <img src="assets/PayhmentSuccess.jpeg" alt="Success" class="status-img">
                    <h4>Payment Successful!</h4>
                    <p>Wrapping up your booking...</p>
                </div>

                <!-- Fail State -->
                <div class="status-view" *ngIf="paymentStatus === 'fail'">
                    <img src="assets/Payment fail.jpeg" alt="Failed" class="status-img">
                    <h4>Payment Failed</h4>
                    <p>There was an issue processing your payment.</p>
                    <button class="btn-retry-modal" (click)="paymentStatus = 'pending'">Try Again</button>
                </div>

                <!-- Pending/Initial State -->
                <ng-container *ngIf="paymentStatus === 'pending'">
                    <div class="amount-display">
                        <span class="label">Total Amount</span>
                        <span class="value">‚Çπ{{ finalAmount | number:'1.0-0' }}</span>
                    </div>

                    <form (ngSubmit)="pay()">
                        <div class="form-group">
                            <label>Card Number</label>
                            <input type="text" placeholder="0000 0000 0000 0000" maxlength="19">
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label>Expiry Date</label>
                                <input type="text" placeholder="MM/YY" maxlength="5">
                            </div>
                            <div class="form-group">
                                <label>CVV</label>
                                <input type="password" placeholder="123" maxlength="3">
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Cardholder Name</label>
                            <input type="text" placeholder="Name on Card">
                        </div>

                        <button type="submit" class="btn-pay modal-pay-btn" [disabled]="isProcessing">
                            <span *ngIf="!isProcessing">Pay ‚Çπ{{ finalAmount | number:'1.0-0' }}</span>
                            <div class="spinner-small" *ngIf="isProcessing"></div>
                        </button>
                    </form>
                </ng-container>
            </div>
        </div>
    </div>
</div>